<!doctype html><html lang=en><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-112742714-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-112742714-1');</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta property="og:site_name" content="davcri"><title>How to reparent nodes with GDScript</title><meta name=description content="While working on a card game with Godot (the code will soon be open sourced), I
had to reparent a …"><meta property="og:title" content="How to reparent nodes with GDScript"><meta property="og:image" itemprop=image content="https://davcri.github.io/img/posts/thumbs/godot-reparent-nodes-programmatically.png"><meta property="og:url" content="https://davcri.github.io/posts/godot-reparent-node/"><meta property="og:description" content="While working on a card game with Godot (the code will soon be open sourced), I
had to reparent a …"><meta property="og:type" content="article"><link rel="shortcut icon" type=image/png href=/img/logo/logo-5.png><link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css integrity=sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4 crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.2.0/css/all.css integrity=sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ crossorigin=anonymous><link rel=stylesheet href=/css/main.css></head><body><script src=https://code.jquery.com/jquery-3.3.1.slim.min.js integrity=sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo crossorigin=anonymous defer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js integrity=sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ crossorigin=anonymous defer></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js integrity=sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm crossorigin=anonymous defer></script><script src=https://use.fontawesome.com/03364e4af9.js defer></script><nav class="navbar navbar-expand-md navbar-dark bg-dark"><a class=navbar-brand href=https://davcri.github.io/><img src=/img/logo/logo-5.png width=32 height=32 alt>
davcri</a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse justify-content-end" id=navbarSupportedContent><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/about/>About me</a></li></ul></div></nav><div class=container><div class="card my-3"><div id=post-container class=card-body><h2 class=card-title>How to reparent nodes with GDScript</h2><div class=row><div class=col><p class=text-muted>2min read<br><span class="badge badge-pill badge-primary">Game Dev</span>
<span class="badge badge-pill badge-primary">Godot Engine</span></p></div><div class=col><p class="text-right text-muted">December 16, 2018</p></div></div><div id=post-header class=text-center><img class="img-fluid rounded" src=/img/posts/thumbs/godot-reparent-nodes-programmatically.png alt="Formula thumbnail" style=max-height:20em></div><hr><div id=post-body class=card-text><p>While working on a card game with Godot (the code will soon be open sourced), I
had to reparent a node from one parent to another. Here it is two simple ways to do it.</p><h2 id=the-problem>The problem</h2><p>Essentially I wanted to move the <code>Card</code> node from the <code>PlayerCards</code> container
to the <code>Field</code> container (a grid where the cards are played).</p><div class="text-center my-4"><figure class="figure my-0"><img src=./img1.png alt="Every node named `Container` may or may not contain a card." class="figure-img img-fluid rounded"><figcaption class=figure-caption><p>Every node named `Container` may or may not contain a card.</p></figcaption></figure></div><p>Let&rsquo;s take an example for the sake of clarity: suppose that we want to move the card from <code>PlayerCards/Container0</code> node to
<code>Field/Container4</code> node.</p><div class="text-center my-4"><figure class="figure my-0"><img src=./img2.png class="figure-img img-fluid rounded"></figure></div><h2 id=first-try>First try</h2><p>The code that I came up at first was:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e># Field.gd (script attached to Field node)</span>

func add_card_at_position(card_container, field_container_index):	
    <span style=color:#75715e># get the Card node</span>
	var card <span style=color:#f92672>=</span> card_container<span style=color:#f92672>.</span>get_child(<span style=color:#ae81ff>0</span>)
    <span style=color:#75715e># move the card into the Container4 (hyp: container_index = 4)</span>
	get_node(<span style=color:#e6db74>&#34;Container&#34;</span> <span style=color:#f92672>+</span> str(field_container_index))<span style=color:#f92672>.</span>add_child(card)
	<span style=color:#75715e># free memory</span>
	card_container<span style=color:#f92672>.</span>queue_free()</code></pre></div><p>In our exampe <code>card_container</code>, the first parameter in the function, is a reference to the <code>Container4</code> node.
So we get its child, that essentially is a <code>Card</code> node and then try to reparent it to move it into the field.</p><p>But I had this error:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>Can&#39;t add child &#39;Card&#39; to &#39;Container4&#39;, already has a parent &#39;Container0&#39;.</code></pre></div><p>The problem is that I&rsquo;m trying to move the <code>Card</code> node that already has a parent.</p><p><strong>In Godot one node can have only one parent at a time.</strong><br>Since Godot doesn&rsquo;t have a <code>reparent()</code> method (as far as I am aware
at least, but I&rsquo;m going to ask to the development team on Discord and update this post eventually),
we have to make this thing by ourselves.</p><h2 id=the-solution>The solution</h2><p>Pretty simple, you need to remove the node from the parent before assign it to a new one:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>func add_card_at_position(card_container, field_container_index):	
	<span style=color:#75715e># duplicate is needed to workaround the error</span>
	var card <span style=color:#f92672>=</span> card_container<span style=color:#f92672>.</span>get_child(<span style=color:#ae81ff>0</span>)
    <span style=color:#75715e># remove card from its parent (ugh...)  &lt;----- solution</span>
    card_container<span style=color:#f92672>.</span>remove_child(card) <span style=color:#75715e>#     &lt;----- solution</span>
	<span style=color:#75715e># free memory</span>
	card_container<span style=color:#f92672>.</span>queue_free()
    <span style=color:#75715e># add child to the Container4 (hyp: container_index = 4)</span>
	get_node(<span style=color:#e6db74>&#34;Container&#34;</span> <span style=color:#f92672>+</span> str(field_container_index))<span style=color:#f92672>.</span>add_child(card)</code></pre></div><h2 id=an-alternative-solution-duplicate>An alternative solution: <code>duplicate()</code></h2><p>Another workaround that can be useful in some cases is
to simply create a duplicate of the <code>Card</code> node and then
move the cloned object to the <code>Field</code>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>func add_card_at_position(card_container, field_container_index):	
	<span style=color:#75715e># duplicate is needed to workaround the error</span>
	var card <span style=color:#f92672>=</span> card_container<span style=color:#f92672>.</span>get_child(<span style=color:#ae81ff>0</span>)<span style=color:#f92672>.</span>duplicate()
	<span style=color:#75715e># free memory</span>
	card_container<span style=color:#f92672>.</span>queue_free()
    <span style=color:#75715e># add child to the Container4 (hyp: container_index = 4)</span>
	get_node(<span style=color:#e6db74>&#34;Container&#34;</span> <span style=color:#f92672>+</span> str(field_container_index))<span style=color:#f92672>.</span>add_child(card)</code></pre></div><p>If you need to duplicate hundreds of objects in a short time frame, then this may not be the best solution
for you.</p></div><div class=share><h4>Share</h4><a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fdavcri.github.io%2fposts%2fgodot-reparent-node%2f">Share on Twitter</a></div></div></div><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")
return;var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;var disqus_shortname='crystal-bit-io';dsq.src='//'+disqus_shortname+'.disqus.com/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=http://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><div class=container><div id=footer class="bg-dark text-white px-3 py-3"><div class=row><div class=col-sm><p class=text-muted>© 2019 Davide Cristini</p></div><div class=col-sm></div><div class="col-sm text-right"><a href=https://davcri.github.io/index.xml><i class="fa fa-2x fa-rss-square"></i></a><a href=https://twitter.com/dav__cri><i class="fa fa-2x fa-twitter-square"></i></a><a href=mailto:davcri91@gmail.com><i class="fa fa-2x fa-envelope-o"></i></a></div></div></div></div></body></html>