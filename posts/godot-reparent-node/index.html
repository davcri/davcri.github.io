<!doctype html><html lang=en>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-112742714-1"></script>
<script>const activateAnalytics=window.location.hostname!=="localhost";if(activateAnalytics){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-112742714-1')}</script>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta property="og:site_name" content="davcri">
<title> How to reparent nodes with GDScript </title>
<meta name=description content="While working on a card game with Godot (the code will soon be open sourced), I
had to reparent a …">
<meta property="og:title" content="How to reparent nodes with GDScript">
<meta property="og:image" itemprop=image content="https://davcri.github.io/img/posts/thumbs/godot-reparent-nodes-programmatically.png">
<meta property="og:url" content="https://davcri.github.io/posts/godot-reparent-node/">
<meta property="og:description" content="While working on a card game with Godot (the code will soon be open sourced), I
had to reparent a …">
<meta property="og:type" content="article">
<link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css integrity=sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4 crossorigin=anonymous>
<link rel=stylesheet href=https://use.fontawesome.com/releases/v5.2.0/css/all.css integrity=sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ crossorigin=anonymous>
<link rel=stylesheet href=/css/main.css>
<script src=/js/three.js></script>
</head>
<body>
<script src=https://code.jquery.com/jquery-3.3.1.slim.min.js integrity=sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo crossorigin=anonymous defer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js integrity=sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ crossorigin=anonymous defer></script>
<script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js integrity=sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm crossorigin=anonymous defer></script>
<script src=https://use.fontawesome.com/03364e4af9.js defer></script>
<div class=container>
<style>.badge-custom{background-color:#f4e9ff;padding:.5em;color:#777}.active{color:#333;border-color:#000;border:rgba(.6,.6,.6,.1);border-width:1px;border-style:solid}</style>
<script src=/js/navbar-logo.js></script>
<nav class="mt-md-5 mt-sm-4 mb-2">
<div class=row>
<div class="col-sm-3 col-12 m-0 p-0">
<canvas id=logo-canvas style=min-height:64px;max-height:160px;box-sizing:border-box;background-color:transparent;width:100%;height:100%>
</div>
<div class="col-sm-9 col-12 text-sm-left text-center">
<h2 id=davcri>
<a href=/ class=text-decoration-none> davcri </a>
</h2>
<p class="muted small mt-0">Freelance developer and tutor</p>
<ul id=nav-links class="list-inline mb-3">
<li class=list-inline-item>
<a class="badge badge-white badge-custom" href=/ title>Home</a>
</li>
<li class=list-inline-item>
<a class="badge badge-white badge-custom" href=/hire/ title>Hire me</a>
</li>
<li class=list-inline-item>
<a class="badge badge-white badge-custom" href=/posts/ title>Blog</a>
</li>
<li class=list-inline-item>
<a class="badge badge-white badge-custom" href=/about/ title>About</a>
</li>
</ul>
<i></i>
</div>
</div>
</nav>
<div id=post-container>
<h2 class=card-title> How to reparent nodes with GDScript </h2>
<div class=row>
<div class=col>
<p class=text-muted>
2min read <br>
<span class="badge badge-primary">Game Dev</span>
<span class="badge badge-primary">Godot Engine</span>
</p>
</div>
<div class=col>
<p class="text-right text-muted">
December 16, 2018
</p>
</div>
</div>
<div id=post-header class=text-center>
<img class="img-fluid rounded" src=/img/posts/thumbs/godot-reparent-nodes-programmatically.png alt="Formula thumbnail" style=max-height:20em>
</div>
<hr>
<div id=post-body class=card-text>
<p>While working on a card game with Godot (the code will soon be open sourced), I
had to reparent a node from one parent to another. Here it is two simple ways to do it.</p>
<h2 id=the-problem>The problem</h2>
<p>Essentially I wanted to move the <code>Card</code> node from the <code>PlayerCards</code> container
to the <code>Field</code> container (a grid where the cards are played).</p>
<div class="text-center my-4">
<figure class="figure my-0">
<img src=./img1.png alt class="figure-img img-fluid rounded">
<figcaption class=figure-caption>
<p>
Every node named `Container` may or may not contain a card.
</p>
</figcaption>
</figure>
</div>
<p>Let&rsquo;s take an example for the sake of clarity: suppose that we want to move the card from <code>PlayerCards/Container0</code> node to
<code>Field/Container4</code> node.</p>
<div class="text-center my-4">
<figure class="figure my-0">
<img src=./img2.png class="figure-img img-fluid rounded">
</figure>
</div>
<h2 id=first-try>First try</h2>
<p>The code that I came up at first was:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e># Field.gd (script attached to Field node)</span>

func add_card_at_position(card_container, field_container_index):	
    <span style=color:#75715e># get the Card node</span>
	var card <span style=color:#f92672>=</span> card_container<span style=color:#f92672>.</span>get_child(<span style=color:#ae81ff>0</span>)
    <span style=color:#75715e># move the card into the Container4 (hyp: container_index = 4)</span>
	get_node(<span style=color:#e6db74>&#34;Container&#34;</span> <span style=color:#f92672>+</span> str(field_container_index))<span style=color:#f92672>.</span>add_child(card)
	<span style=color:#75715e># free memory</span>
	card_container<span style=color:#f92672>.</span>queue_free()
</code></pre></div><p>In our exampe <code>card_container</code>, the first parameter in the function, is a reference to the <code>Container4</code> node.
So we get its child, that essentially is a <code>Card</code> node and then try to reparent it to move it into the field.</p>
<p>But I had this error:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>Can&#39;t add child &#39;Card&#39; to &#39;Container4&#39;, already has a parent &#39;Container0&#39;.
</code></pre></div><p>The problem is that I&rsquo;m trying to move the <code>Card</code> node that already has a parent.</p>
<p><strong>In Godot one node can have only one parent at a time.</strong><br>
Since Godot doesn&rsquo;t have a <code>reparent()</code> method (as far as I am aware
at least, but I&rsquo;m going to ask to the development team on Discord and update this post eventually),
we have to make this thing by ourselves.</p>
<h2 id=the-solution>The solution</h2>
<p>Pretty simple, you need to remove the node from the parent before assign it to a new one:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>func add_card_at_position(card_container, field_container_index):	
	<span style=color:#75715e># duplicate is needed to workaround the error</span>
	var card <span style=color:#f92672>=</span> card_container<span style=color:#f92672>.</span>get_child(<span style=color:#ae81ff>0</span>)
    <span style=color:#75715e># remove card from its parent (ugh...)  &lt;----- solution</span>
    card_container<span style=color:#f92672>.</span>remove_child(card) <span style=color:#75715e>#     &lt;----- solution</span>
	<span style=color:#75715e># free memory</span>
	card_container<span style=color:#f92672>.</span>queue_free()
    <span style=color:#75715e># add child to the Container4 (hyp: container_index = 4)</span>
	get_node(<span style=color:#e6db74>&#34;Container&#34;</span> <span style=color:#f92672>+</span> str(field_container_index))<span style=color:#f92672>.</span>add_child(card)
</code></pre></div><h2 id=an-alternative-solution-duplicate>An alternative solution: <code>duplicate()</code></h2>
<p>Another workaround that can be useful in some cases is
to simply create a duplicate of the <code>Card</code> node and then
move the cloned object to the <code>Field</code>.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>func add_card_at_position(card_container, field_container_index):	
	<span style=color:#75715e># duplicate is needed to workaround the error</span>
	var card <span style=color:#f92672>=</span> card_container<span style=color:#f92672>.</span>get_child(<span style=color:#ae81ff>0</span>)<span style=color:#f92672>.</span>duplicate()
	<span style=color:#75715e># free memory</span>
	card_container<span style=color:#f92672>.</span>queue_free()
    <span style=color:#75715e># add child to the Container4 (hyp: container_index = 4)</span>
	get_node(<span style=color:#e6db74>&#34;Container&#34;</span> <span style=color:#f92672>+</span> str(field_container_index))<span style=color:#f92672>.</span>add_child(card)
</code></pre></div><p>If you need to duplicate hundreds of objects in a short time frame, then this may not be the best solution
for you.</p>
</div>
</div>
<div id=disqus_thread></div>
<script type=text/javascript>(function(){var a,b;if(window.location.hostname=="localhost")return;a=document.createElement('script'),a.type='text/javascript',a.async=!0,b='crystal-bit-io',a.src='//'+b+'.disqus.com/embed.js',(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=http://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
<div id=footer class=mt-4>
<hr>
<div class=row>
<div class=col-5>
<p class="small text-muted">© 2022 Davide Cristini</p>
</div>
<div class="col-7 text-right">
<ul id="nav-social m-sm-0" class=list-inline>
<li class="list-inline-item m-md-2 m-sm-2">
<a href=https://github.com/davcri target=_blank>
<i class="fab fa-github fa-1x text-muted"></i>
</a>
</li>
<li class="list-inline-item m-md-2 m-sm-2">
<a href=https://twitter.com/dav__cri target=_blank>
<i class="fab fa-twitter fa-1x text-muted"></i>
</a>
</li>
<li class="list-inline-item m-md-2 m-sm-2">
<a href=mailto:davcri91@gmail.com target=_blank>
<i class="fas fa-envelope fa-1x text-muted"></i>
</a>
</li>
<li class="list-inline-item m-md-2 m-sm-2">
<a href=https://www.linkedin.com/in/davide-cristini-a8199715a/ target=_blank>
<i class="fab fa-linkedin fa-1x text-muted"></i>
</a>
</li>
</ul>
</div>
</div>
</div>
</div>
<script type=text/javascript src="https://cdn.jsdelivr.net/npm/cookie-bar/cookiebar-latest.min.js?tracking=1&thirdparty=1&always=1"></script>
<script>function enableGoogleAnalytics(){window.dataLayer=window.dataLayer||[];function a(){dataLayer.push(arguments)}a('js',new Date),a('config','')}function getCookiesAsObj(){return document.cookie.split(';').reduce((b,d)=>{const[c,a]=d.trim().split('=').map(decodeURIComponent),e=a=>/^\d+$/.test(a);try{return Object.assign(b,{[c]:e(a)?a:JSON.parse(a)})}catch(d){return Object.assign(b,{[c]:a})}},{})}const cookies=getCookiesAsObj();cookies.cookiebar==='CookieAllowed'?enableGoogleAnalytics():document.addEventListener('click',b=>{const a=getCookiesAsObj();a.cookiebar==='CookieAllowed'&&this.enableGoogleAnalytics()})</script>
</body>
</html>