<!doctype html><html lang=en><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-112742714-1"></script>
<script>const activateAnalytics=window.location.hostname!=="localhost";if(activateAnalytics){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-112742714-1")}</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta property="og:site_name" content="davcri"><title>QEMU: quick guide to a powerful virtualization tool</title><meta name=description content="Sometimes you want to try a new operating system or particular software
configuration, but you …"><meta property="og:title" content="QEMU: quick guide to a powerful virtualization tool"><meta property="og:image" itemprop=image content="https://davcri.github.io/img/posts/thumbs/qemu.png"><meta property="og:url" content="https://davcri.github.io/posts/qemu/"><meta property="og:description" content="Sometimes you want to try a new operating system or particular software
configuration, but you …"><meta property="og:type" content="article"><link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css integrity=sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4 crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.2.0/css/all.css integrity=sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ crossorigin=anonymous><link rel=stylesheet href=/css/main.css><script src=/js/three.js></script></head><body><script src=https://code.jquery.com/jquery-3.3.1.slim.min.js integrity=sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo crossorigin=anonymous defer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js integrity=sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ crossorigin=anonymous defer></script>
<script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js integrity=sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm crossorigin=anonymous defer></script>
<script src=https://use.fontawesome.com/03364e4af9.js defer></script><div class=container><style>.badge-custom{background-color:#f4e9ff;padding:.5em;color:#777}.active{color:#333;border-color:#000;border:rgba(.6,.6,.6,.1);border-width:1px;border-style:solid}</style><nav class="mt-md-5 mt-sm-4 mb-4"><div class=row><div class="col-sm-3 col-12 m-0 p-0"><canvas id=logo-canvas style=min-height:64px;max-height:160px;box-sizing:border-box;background-color:transparent;width:100%;height:100%></div><div class="col-sm-9 col-12 text-sm-left text-center"><h2 id=davcri><a href=/ class=text-decoration-none>davcri</a></h2><p class="muted small mt-0"></p><ul id=nav-links class="list-inline mb-3"><li class=list-inline-item><a class="badge badge-white badge-custom" href=/ title>Home</a></li><li class=list-inline-item><a class="badge badge-white badge-custom" href=/posts/ title>Blog</a></li><li class=list-inline-item><a class="badge badge-white badge-custom" href=/hire/ title>Work with me</a></li><li class=list-inline-item><a class="badge badge-white badge-custom" href=/about/ title>About</a></li></ul><i></i></div></div></nav><script src=/js/navbar-logo.js></script><div id=post-container><h2 class=card-title>QEMU: quick guide to a powerful virtualization tool</h2><div class=row><div class=col><p class=text-muted>4min read<br><span class="badge badge-primary">Tutorial</span>
<span class="badge badge-primary">Linux</span></p></div><div class=col><p class="text-right text-muted">March 10, 2018</p></div></div><div id=post-header class=text-center><img class="img-fluid rounded" src=/img/posts/thumbs/qemu.png alt="Qemu thumbnail" style=max-height:20em></div><hr><div id=post-body class=card-text><p>Sometimes you want to try a new operating system or particular software
configuration, but you don&rsquo;t want to touch your precious PC, risking
to make your main production system unbootable.
In these cases, software virtualization is your friend.</p><p><strong>QEMU</strong> is a great open source virtualization tool
available exclusively on Linux based systems. Compared to <em>Virtualbox</em>, it is better
integrated and has a smaller footprint.</p><h1 id=overview>Overview</h1><p>In this quick guide you will see how to use QEMU to run a Linux Distro (but
you can run also other systems like <em>Windows</em>, <em>Android x86</em> or others).
The main steps that we are going to do are:</p><ol><li>Install <code>qemu</code></li><li>Download an operating system to virtualize (called <em>guest OS</em>)</li><li>Run the guest OS</li><li>[<em>Optional</em>] Configure a virtual disk (to enable data persistence)</li><li>[<em>Optional</em>] Create a simple script to easily run the guest OS</li></ol><p>Let&rsquo;s get started!</p><h2 id=1-installing-qemu>1. Installing qemu</h2><p>First open your terminal and install qemu:</p><p>For Ubuntu and derivatives:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>apt install qemu</span></span></code></pre></div></p><p>Or for Arch linux and derivatives:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pacman -S qemu</span></span></code></pre></div><h2 id=2-download-an-operating-system>2. Download an operating system</h2><p>Right now we will use <em>Ubuntu</em> as a guest OS, but feel free to experiment
with many others: QEMU supports a large amount of systems.</p><p>Follow these steps to create a new directory and download the Ubuntu ISO:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd 
</span></span><span style=display:flex><span>mkdir virtual-systems 
</span></span><span style=display:flex><span>cd virtual-systems
</span></span><span style=display:flex><span>wget -c http://releases.ubuntu.com/16.04/ubuntu-16.04.4-desktop-amd64.iso</span></span></code></pre></div><h2 id=3-run-the-guest-operating-system>3. Run the guest operating system</h2><p>QEMU can be easily used from the terminal: I prefer this way, because I
encountered some small quirks with the available graphic frontends (but in the
last years they improved a lot).
However let&rsquo;s focus on getting things done, so grab the terminal and type:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>qemu-system-x86_64 -enable-kvm -m 2G ubuntu-16.04.4-desktop-amd64.iso</span></span></code></pre></div><p>The last command tells qemu to virtualize an x86 environment with 2 GigaBytes
of RAM and with KVM enabled (it speeds up the virtualization, a lot!).</p><div class="text-center my-4"><figure class="figure my-0"><img src=./qemu-ubuntu.png alt class="figure-img img-fluid rounded"><figcaption class=figure-caption><p>Ubuntu as a guest</p></figcaption></figure></div><p>Now you can experiment with the live operating system as much as you want,
because <strong>changes made now, won&rsquo;t be persisted</strong>. This means that if you reboot the
guest OS, you will lose all your changes.</p><p>If you want to enable persistence, continue with the section!</p><h2 id=4-configure-a-virtual-disk>4. Configure a virtual disk</h2><p>To keep changes across reboots (of the guest os, not out main system), we need
to save them somewhere. To tell QEMU where to persist the data, we can use a so called
<em>virtual disk image</em>. Let&rsquo;s create one:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># create a file &#34;disk_image&#34; with format qcow2 and 40GB of max space</span>
</span></span><span style=display:flex><span>qemu-img create -f qcow2 disk_image 40G</span></span></code></pre></div><p>This command will create a virtual disk file called <code>disk_image</code>: the parameters
specifies a maximum size of 40GB and the <a href=https://en.wikipedia.org/wiki/Qcow>qcow2</a>
format. Don&rsquo;t worry about the size, because the file will grow only
when the space will be actually used by the virtual OS.
Initially it will take only few KBs:</p><div class="text-center my-4"><figure class="figure my-0"><img src=./image-size.png class="figure-img img-fluid rounded"></figure></div><p>At this point we can tell QEMU to actually use the virtual disk:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>qemu-system-x86_64 -cdrom ubuntu-16.04.4-desktop-amd64.iso -boot order<span style=color:#f92672>=</span>d -enable-kvm -m 2G -drive file<span style=color:#f92672>=</span>disk_image</span></span></code></pre></div><p>Finally we boot up a virtual system with persistance!</p><p>Now <strong>start the Ubuntu installation</strong>. When it&rsquo;s finished, you will have all the
data in <code>disk_image</code> and it will be possible to run Ubuntu using only this file, without
the ISO.</p><p>From now on, you can start the guest OS (with persistance enabled) using:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>qemu-system-x86_64 -enable-kvm -m 2G -drive file<span style=color:#f92672>=</span>disk_image
</span></span></code></pre></div><p>do you find it too long to type ? Then read the final step.</p><h2 id=5-create-a-script-to-run-the-os>5. Create a script to run the OS</h2><p>A good idea to easily launch your virutal system is to use a script. Open an
editor and copy/paste this code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>options<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;-vga qxl --enable-kvm -m 4G&#34;</span>
</span></span><span style=display:flex><span>image<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;disk_image&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>qemu-system-x86_64 $options $image</span></span></code></pre></div><p>Save it as <code>launch-ubuntu.sh</code> and make it executable using
<code>chmodx +x launch-ubuntu.sh</code>.</p><p>Everytime that you want to run your virtual Ubuntu system, you can
simply go into the <code>~/virtual-systems</code> folder and execute it:
<code>./launch-ubuntu.sh</code>.</p><h3 id=possible-quirks>Possible quirks</h3><p>When running a virtual system, you can encounter some problem. Personally I
had some issues with setting the resolution of the guest OS. For example
I once installed Antergos (Xfce) guest and I had only a minimal 640x480
resolution.
To fix this little problem I had to install <code>qxl</code> on the guest system.
So for Antergos there is this AUR package:
<a href=https://aur.archlinux.org/packages/xf86-video-qxl/>https://aur.archlinux.org/packages/xf86-video-qxl/</a>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>yaourt -S xf86-video-qxl</span></span></code></pre></div><p>After installing it, simply reboot and then change the resolution.</p><hr><h2 id=running-examples>Running examples</h2><p><div class="text-center my-4"><figure class="figure my-0"><img src=./android6.png alt class="figure-img img-fluid rounded"><figcaption class=figure-caption><p>Android on qemu</p></figcaption></figure></div><div class="text-center my-4"><figure class="figure my-0"><img src=./antergos.png alt class="figure-img img-fluid rounded"><figcaption class=figure-caption><p>Antergos on qemu</p></figcaption></figure></div><div class="text-center my-4"><figure class="figure my-0"><img src=./windows7.png alt class="figure-img img-fluid rounded"><figcaption class=figure-caption><p>Windows 7 on qemu</p></figcaption></figure></div></p><h2 id=useful-links>Useful links</h2><ul><li><a href=https://www.qemu.org/>https://www.qemu.org/</a></li><li><a href=https://wiki.archlinux.org/index.php/>https://wiki.archlinux.org/index.php/</a></li></ul></div></div><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")return;var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,t="crystal-bit-io",e.src="//"+t+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=http://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a><div id=footer class=mt-4><hr><div class=row><div class=col-5><p class="small text-muted">© 2022 Davide Cristini</p></div><div class="col-7 text-right"><ul id="nav-social m-sm-0" class=list-inline><li class="list-inline-item m-md-2 m-sm-2"><a href=https://github.com/davcri target=_blank><i class="fab fa-github fa-1x text-muted"></i></a></li><li class="list-inline-item m-md-2 m-sm-2"><a href=https://twitter.com/dav__cri target=_blank><i class="fab fa-twitter fa-1x text-muted"></i></a></li><li class="list-inline-item m-md-2 m-sm-2"><a href=mailto:davcri91@gmail.com target=_blank><i class="fas fa-envelope fa-1x text-muted"></i></a></li><li class="list-inline-item m-md-2 m-sm-2"><a href=https://www.linkedin.com/in/davide-cristini-a8199715a/ target=_blank><i class="fab fa-linkedin fa-1x text-muted"></i></a></li></ul></div></div></div></div><script>const videos=document.getElementsByTagName("video");let i=0;for(const e of videos)e.controls&&(i+=1,e.removeAttribute("controls"),setTimeout(t=>{e.play()},i*1e3))</script><script type=text/javascript src="https://cdn.jsdelivr.net/npm/cookie-bar/cookiebar-latest.min.js?tracking=1&thirdparty=1&always=1"></script><script>function enableGoogleAnalytics(){window.dataLayer=window.dataLayer||[];function e(){dataLayer.push(arguments)}e("js",new Date),e("config",'')}function getCookiesAsObj(){return document.cookie.split(";").reduce((t,s)=>{const[n,e]=s.trim().split("=").map(decodeURIComponent),o=e=>/^\d+$/.test(e);try{return Object.assign(t,{[n]:o(e)?e:JSON.parse(e)})}catch(s){return Object.assign(t,{[n]:e})}},{})}const cookies=getCookiesAsObj();cookies.cookiebar==="CookieAllowed"?enableGoogleAnalytics():document.addEventListener("click",t=>{const e=getCookiesAsObj();e.cookiebar==="CookieAllowed"&&this.enableGoogleAnalytics()})</script></body></html>